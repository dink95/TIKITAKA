<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>TIKITAKA &ndash; 상품조회 </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,400,700">
    <link rel="stylesheet" href="../fonts/icomoon/style.css">

    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/magnific-popup.css">
    <link rel="stylesheet" href="../css/jquery-ui.css">
    <link rel="stylesheet" href="../css/owl.carousel.min.css">
    <link rel="stylesheet" href="../css/owl.theme.default.min.css">
    <link rel="stylesheet" href="../css/aos.css">
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>

<div class="site-wrap">
    <header class="site-navbar" role="banner">
        <!--replace 헤더-->
        <div class="site-navbar-top" th:replace="common::header(product_view)">
        </div>
        <!------------->
        <!--replace-login-------------------------------->

        <nav class="site-navigation text-right text-md-center" role="navigation"
             th:replace="common::menu(product_view)">
        </nav>
        <!----------------------------------------------------------->
    </header>
    <!--replace logo-login-->
    <div class="bg-light py-3" th:replace="common::logo(product_view)">
    </div>
    <!------------------------->
    <div class="site-section margin-top-2"><!--margin class-->
        <div class="container">

            <input type="hidden" id="p_id" th:value="${session.mbrId}">
            <input type="hidden" id="query" val="">
            <div class="row align-items-center" style="border-bottom: 1px solid #ddd; padding-top:10px">
                <div class="col-12 col-md-6 order-1 order-md-1  text-center">
                    <figure class="block-4-image">
                        <img id="mainDetailImg" src="" alt="Image placeholder" class="img-fluid"
                             style="width: 272.66px; height: 272.66px; border: 1px solid #ddd;">
                    </figure>
                </div>
                <div class="col-12 col-md-6 order-2 order-md-2  text-left">
                    <div style="border-bottom: 1px solid #dee2e6">
                        <h1 id="detailName"></h1>
                        <h1 id="detailPrice"></h1><span>원</span>
                    </div>
                    <p>판매자아이디:&nbsp<span id="selId"></span></p>
                    <p>거래방법:&nbsp<span id="detailWay"></span></p>
                    <p>거래지역:&nbsp<span id="detailAddr"></span></p>
                    <a href="///" id="detailMap">지도보기</a>
                    <div class="ButtonNav">
                        <input type="button" class="btn btn-primary "
                               value="거래하기" onclick="goRegist()">
                        <input type="button" class="btn btn-info"
                               value="수정하기" onclick="goRegist()">
                        <input type="button" class="btn btn-primary "
                               value="취소하기">
                        <input type="button" class="btn btn-danger"
                               value="삭제하기">
                        <a href="/member/report">
                            <input type="button" class="btn btn-danger "
                                   value="신고하기"></a>
                    </div>
                </div>
            </div>

            <div class="site-section block-3 site-blocks-2 bg-light" style="padding-top:10px;">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="nonloop-block-3 owl-carousel detailImgContainer">

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row align-items-center" style="border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;  margin:10px 0 10px 0; padding:10px 0 10px 0;">
                <div class="col-12 col-md-3 order-1 order-md-1  text-center">
                    <label for="p_content">상세정보</label><span
                        class="text-danger">*</span></div>
                <div class="col-12 col-md-9 order-2 order-md-2  text-left">
                    <div class="p_content" id="p_content" style="border: 1px solid #ddd; height: 300px;">신발 240 캔버스</div>
                </div>
            </div>

        </div>
    </div>
    <a id="arrow_up" class="scroll_up" onclick="scroll_up()"> </a>

    <style>
        #detailName{
         color:#000;
            font-size: 20px;
        }
        #detailPrice{
            color: #000;
            display: inline-block;
        }
        #detailPrice+span{

            font-size: 20px;
            color: #000;
        }
        #selId{
            color: #000;
        }
        #detailWay{
            color: #000;
        }
        #detailMap{
            color: #9792ea;
        }
        .ButtonNav{
            padding:10px 0 10px 0;
        }
    </style>
</div>
</div>
</span>
<script src="../js/jquery-3.3.1.min.js"></script>
<script src="../js/jquery-ui.js"></script>
<script src="../js/popper.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/owl.carousel.min.js"></script>
<script src="../js/jquery.magnific-popup.min.js"></script>
<script src="../js/aos.js"></script>

<script src="../js/main.js"></script>
<script>

    function getProductDetail() {

        var param = {
            prodNo:$('#query').val(),
        }

        $.ajax({
            url: '/product/detail.do',
            data: param,
            type: 'post',
            dataType: 'json'
        }).done(function (data) {
            drawPrdList(data)

        }).fail(function (data, textStatus, errorThrown) {
            console.log(textStatus);
        });


    }

    function drawPrdList(data) {
        console.log("@@detail data", data.dataDetail);

        if (typeof data.dataDetail !== 'undefined') {
           var container = $('.detailImgContainer');
            container.empty();
            var contents = '';
            var imgPath = '';

                //매번 컨텐츠가 달라야하니 초기화
                contents = '';
                //이미지경로를 미리 만들어놓는다.
                imgPath = '/istatic/images/' + data.dataDetail.prodNo + '/1.jpg';
                //메인 이미지 html
                $('#mainDetailImg').attr("src",imgPath);
                //디테일 정보들
                $('#detailName').text(data.dataDetail.prodNm);
                $('#detailPrice').text(data.dataDetail.prodPrc);
                $('#selId').text(data.dataDetail.selId);
                $('#detailWay').text(data.dataDetail.way);

            for(var i =2; i<6; i++) {

                imgDetailPath = '/istatic/images/' + data.dataDetail.prodNo + '/' +i+'.jpg';
                console.log(imgDetailPath);

                contents +='<div class="item">';
                contents +='<div class="block-4 text-center">';
                contents +='<figure class="block-4-image">';
                contents +='<img src="' + imgDetailPath + '" alt="Image placeholder" class="img-fluid">';
                contents +='</figure>';
                contents +='</div>';
                contents +='</div>';

            };

                //그리드에 삽입
                container.append(contents);

        }

    }

    function searchParam(key) {
        return new URLSearchParams(location.search).get(key);
    };
    console.log('@@ urlparams', searchParam('prodNo'));
    $('#query').val( searchParam('prodNo'));
    if ($('#selId').text() != $('#p_id').val()) {
        $('.ButtonNav>input:nth-child(2n-1)').css('display', 'none');
        $('.ButtonNav>a>input').css('display', 'none');
    } else {
        $('.ButtonNav>input:nth-child(2n)').css('display', 'none');
    }

    $(document).ready(function () {
        getProductDetail();
    });
</script>

</body>
</html>